<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
            crossorigin="anonymous"></script>

    <style>
        input:disabled {    /* 왜안되지 */
            background: #198754;
        }
    </style>
    <script>
        let selTime = "";

        function events() {
            $(".time-label").on("click", function() {   // label에 임의 클래스 문구 넣고 클릭이벤트, 날짜 선택했을때 클릭이벤트가 발생하지 않음
                // alert('클릭이벤트');
                const reservationDate = $("#reservationDate").val();
                const ceoIdx = $("#ceoIdx").val();
                selTime = $(this).attr("for");   // .attr : 해당 속성값 가져오기
                // console.log(selTime);   // 날짜 선택했을때 else로 안넘어감 클릭 이벤트가 발생하지 않음

                if (reservationDate == "") {
                    alert("날짜를 선택하세요.")
                }
                else {
                    // alert("통신 good");
                    $.ajax({
                        url: "/bmn/reservationCeo/reservationCeoTimeInfo",
                        type: "POST",
                        data: {reservationDate: reservationDate, ceoIdx: ceoIdx, reservationTime: selTime},
                        success: function (data) {
                            alert("ajax 통신 성공.");
                            const reservationPeople = data.reservationPeople;
                            const reservationContents = data.reservationContents;

                            $("#reservationPeople").val(reservationPeople);
                            $("#reservationContents").val(reservationContents);

                        },
                        error: function () {
                            alert("ajax 통신 시 오류가 발생했습니다.");
                        }
                    });
                }
            });
        }

        $(document).ready(function () {
            $("#cancel").on("click", function () {
                // alert("클릭 이벤트");
                let test = $("#btnCheck").find("label");    // btnCheck div 자손 label 태그들 리스트로 반환
                console.log(test[0]);   // 0번 인덱스의 녀석 출력

                let tempHtml = `<br>경아</br>메롱`;
                // test[0].append(tempHtml);

                console.log($("#11").val());

                for (let i = 0; i < test.length; i++) {
                    test[i].append(tempHtml);
                }

                // if ($().attr("id") == 1) { alert("id 는 1"); }   // 태그가 한개로 특정되어야함

                // history.back();
            });
            // $("#submit").on("click", function () {
            //
            // });
            $("#reservationDate").on("change", function () {
                // alert("변경 이벤트 발생");
                const reservationDate = $("#reservationDate").val();    // 문자열로 제대로 들고옴
                const ceoIdx = $("#ceoIdx").val();

                $.ajax({
                    url: "/bmn/reservationCeo/ceoIdx=" + ceoIdx,    // 주소 수정!!!!!!!!!!  (로그인 구현 후 타임리프로 히든태그 값 주기)
                    type: "POST",
                    data: {reservationDate: reservationDate, ceoIdx: ceoIdx},
                    success: function (data) {  // data = dateList
                        // alert("ajax 통신 성공.");

                        // 버튼 내용들 지웠다가 다시 쓰기
                        $("#replace").empty();
                        let contents =
                            "<div class=\"row border mb-3\">\n" +
                            "                        <h3>오전</h3>\n" +
                            "                        <div class=\"row mb-2\">\n" +
                            "                            <div class=\"d-flex\">\n" +
                            "                                <input type=\"radio\" class=\"btn-check\" name=\"reservationTime\" id=\"11\" value=\"11\">\n" +
                            "                                <label class=\"btn btn-success opacity-100 me-2 d-flex justify-content-center align-items-center time-label\" for=\"11\"  style=\"width: 10em; height: 5em;\" id=\"lab11\">11:00<br></label>\n" +
                            "                                <button class=\"btn btn-success opacity-100 me-2\" type=\"button\" style=\"width: 10em; height: 5em; visibility: hidden;\"></button>\n" +
                            "                                <button class=\"btn btn-success opacity-100 me-2\" type=\"button\" style=\"width: 10em; height: 5em; visibility: hidden;\"></button>\n" +
                            "                                <button class=\"btn btn-success opacity-100 me-2\" type=\"button\" style=\"width: 10em; height: 5em; visibility: hidden;\"></button>\n" +
                            "                            </div>\n" +
                            "                        </div>\n" +
                            "\n" +
                            "                        <h3>오후</h3>\n" +
                            "                        <div class=\"row mb-2\">\n" +
                            "                            <div class=\"d-flex\">\n" +
                            "                                <input type=\"radio\" class=\"btn-check\" name=\"reservationTime\" id=\"12\" value=\"12\">\n" +
                            "                                <label class=\"btn btn-success opacity-100 me-2 d-flex justify-content-center align-items-center time-label\" for=\"12\"  style=\"width: 10em; height: 5em;\" id=\"lab12\">12:00</label>\n" +
                            "                                <input type=\"radio\" class=\"btn-check\" name=\"reservationTime\" id=\"01\" value=\"01\">\n" +
                            "                                <label class=\"btn btn-success opacity-100 me-2 d-flex justify-content-center align-items-center time-label\" for=\"01\"  style=\"width: 10em; height: 5em;\" id=\"lab01\">01:00</label>\n" +
                            "                                <input type=\"radio\" class=\"btn-check\" name=\"reservationTime\" id=\"02\" value=\"02\">\n" +
                            "                                <label class=\"btn btn-success opacity-100 me-2 d-flex justify-content-center align-items-center time-label\" for=\"02\"  style=\"width: 10em; height: 5em;\" id=\"lab02\">02:00</label>\n" +
                            "                                <input type=\"radio\" class=\"btn-check\" name=\"reservationTime\" id=\"03\" value=\"03\">\n" +
                            "                                <label class=\"btn btn-success opacity-100 me-2 d-flex justify-content-center align-items-center time-label\" for=\"03\"  style=\"width: 10em; height: 5em;\" id=\"lab03\">03:00</label>\n" +
                            "                            </div>\n" +
                            "                        </div>\n" +
                            "                        <div class=\"row mb-2\">\n" +
                            "                            <div class=\"d-flex\">\n" +
                            "                                <input type=\"radio\" class=\"btn-check\" name=\"reservationTime\" id=\"04\" value=\"04\">\n" +
                            "                                <label class=\"btn btn-success opacity-100 me-2 d-flex justify-content-center align-items-center time-label\" for=\"04\"  style=\"width: 10em; height: 5em;\" id=\"lab04\">04:00</label>\n" +
                            "                                <input type=\"radio\" class=\"btn-check\" name=\"reservationTime\" id=\"05\" value=\"05\">\n" +
                            "                                <label class=\"btn btn-success opacity-100 me-2 d-flex justify-content-center align-items-center time-label\" for=\"05\"  style=\"width: 10em; height: 5em;\" id=\"lab05\">05:00</label>\n" +
                            "                                <input type=\"radio\" class=\"btn-check\" name=\"reservationTime\" id=\"06\" value=\"06\">\n" +
                            "                                <label class=\"btn btn-success opacity-100 me-2 d-flex justify-content-center align-items-center time-label\" for=\"06\"  style=\"width: 10em; height: 5em;\" id=\"lab06\">06:00</label>\n" +
                            "                                <input type=\"radio\" class=\"btn-check\" name=\"reservationTime\" id=\"07\" value=\"07\">\n" +
                            "                                <label class=\"btn btn-success opacity-100 me-2 d-flex justify-content-center align-items-center time-label\" for=\"07\"  style=\"width: 10em; height: 5em;\" id=\"lab07\">07:00</label>\n" +
                        "                            </div>\n" +
                            "                        </div>\n" +
                            "                        <div class=\"row mb-2\">\n" +
                            "                            <div class=\"d-flex\">\n" +
                            "                                <input type=\"radio\" class=\"btn-check\" name=\"reservationTime\" id=\"08\" value=\"08\">\n" +
                            "                                <label class=\"btn btn-success opacity-100 me-2 d-flex justify-content-center align-items-center time-label\" for=\"08\"  style=\"width: 10em; height: 5em;\" id=\"lab08\">08:00</label>\n" +
                            "                                <input type=\"radio\" class=\"btn-check\" name=\"reservationTime\" id=\"09\" value=\"09\">\n" +
                            "                                <label class=\"btn btn-success opacity-100 me-2 d-flex justify-content-center align-items-center time-label\" for=\"09\"  style=\"width: 10em; height: 5em;\" id=\"lab09\">09:00</label>\n" +
                            "                                <button class=\"btn btn-success opacity-100 me-2\" type=\"button\" style=\"width: 10em; height: 5em; visibility: hidden;\"></button>\n" +
                            "                                <button class=\"btn btn-success opacity-100 me-2\" type=\"button\" style=\"width: 10em; height: 5em; visibility: hidden;\"></button>\n" +
                            "                            </div>\n" +
                            "                        </div>\n" +
                            "                    </div>";
                        $("#replace").append(contents)

                        let labelList = $("#replace").find("label");    // replace div 자손 label 태그들 리스트로 반환

                        for (let i = 0; i < labelList.length; i++) {    // 라벨리스트 만큼 반복문
                            let customerName = data[i]?.customerName;   // Uncaught TypeError: Cannot read properties of undefined 에러 발생 시 . 앞에 ? 붙이기
                            let reservationPeople = data[i]?.reservationPeople;
                            let reservationTime = data[i]?.reservationTime;

                            console.log(customerName);
                            console.log(reservationPeople);
                            console.log(i);

                            // let tempHtml = `\n${customerName}${reservationPeople}명`;
                            if (customerName != undefined && reservationPeople != undefined) {  // 둘 다 언디파인드가 아닌 경우에만 출력하게끔
                                for (let j in labelList) {
                                    console.log(j.attr('for'));
                                }
                                // if (reservationTime == selTime) {   // 받아온 reservationTime과 라디오의 val이 일치하는 radio에 넣어야함
                                    let tempHtml = customerName + '\n\n\n\n\n' + reservationPeople + " 명";
                                    console.log(labelList[i])
                                    labelList[i].append(tempHtml);  // 라벨리스트에 해당 내용 입력.(이러면 모든 라벨 리스트에 입력됨)
                                // }
                            }
                        }

                        // DTO .. 안될거 같고 for문이라 List로 받고 add로 추가 해야할거같음.


                        // 버튼 클릭하면 해당 버튼의 예약 정보(인원, 상세 내용)
                        // for (let i = 0; i < data.length; i++) { // data는 List, data[i]는 reservationDTO 타입 배열임
                        //     data[i].customerName     // 입력시킬방법 찾는중.... 이렇게 받아와서 배열에 입력을 시킬까. 그러면 name만 있는 배열, 인원만 있는 배열.. 버튼에 다 번호를 주고 해당 번호에 val 입력
                        //     if ($(".클래스문구").attr("id") == i) { }
                        //     // 클래스에 문구가있는 태그들의 아이디 값과 i의 값이 같으면(== 나 .eqauls 사용)
                        // }

                        events();
                    },
                    error: function () {
                        alert("ajax 통신 시 오류가 발생했습니다.");
                    }
                });
            });

            events();
        });
    </script>

</head>
<body>
<header th:replace="~{layout/header :: header}"></header>

<main class="container-sm" id="main">
    <form action="/bmn/reservationCeo/ceoIdx=2/customerIdx=2" method="post">
        <div class="row">
            <div class="col-2">
                <div class="border">
                    <label for="reservationPeople" class="form-label">예약 인원</label>
                    <input type="text" class="form-control" id="reservationPeople" name="reservationPeople">
                    <label for="reservationContents" class="form-label">상세 내용</label>
                    <input type="text" class="form-control" id="reservationContents" name="reservationContents">
                </div>
            </div>
            <div class="col-10">
                <div class="row">
                    <input type="date" name="reservationDate" id="reservationDate">
                </div>
                <div id="replace">
                    <div class="row border mb-3">
                        <h3>오전</h3>
                        <div class="row mb-2">
                            <div class="d-flex">
                                <input type="radio" class="btn-check" name="reservationTime" id="11" value="11">
                                <label class="btn btn-success opacity-100 me-2 d-flex justify-content-center align-items-center time-label" for="11"  style="width: 10em; height: 5em;" id="lab11">11:00<br></label>
                                <button class="btn btn-success opacity-100 me-2" type="button" style="width: 10em; height: 5em; visibility: hidden;"></button>
                                <button class="btn btn-success opacity-100 me-2" type="button" style="width: 10em; height: 5em; visibility: hidden;"></button>
                                <button class="btn btn-success opacity-100 me-2" type="button" style="width: 10em; height: 5em; visibility: hidden;"></button>
                            </div>
                        </div>

                        <h3>오후</h3>
                        <div class="row mb-2">
                            <div class="d-flex">
                                <input type="radio" class="btn-check" name="reservationTime" id="12" value="12">
                                <label class="btn btn-success opacity-100 me-2 d-flex justify-content-center align-items-center time-label" for="12"  style="width: 10em; height: 5em;" id="lab12">12:00</label>
                                <input type="radio" class="btn-check" name="reservationTime" id="01" value="01">
                                <label class="btn btn-success opacity-100 me-2 d-flex justify-content-center align-items-center time-label" for="01"  style="width: 10em; height: 5em;" id="lab01">01:00</label>
                                <input type="radio" class="btn-check" name="reservationTime" id="02" value="02">
                                <label class="btn btn-success opacity-100 me-2 d-flex justify-content-center align-items-center time-label" for="02"  style="width: 10em; height: 5em;" id="lab02">02:00</label>
                                <input type="radio" class="btn-check" name="reservationTime" id="03" value="03">
                                <label class="btn btn-success opacity-100 me-2 d-flex justify-content-center align-items-center time-label" for="03"  style="width: 10em; height: 5em;" id="lab03">03:00</label>
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="d-flex">
                                <input type="radio" class="btn-check" name="reservationTime" id="04" value="04">
                                <label class="btn btn-success opacity-100 me-2 d-flex justify-content-center align-items-center time-label" for="04"  style="width: 10em; height: 5em;" id="lab04">04:00</label>
                                <input type="radio" class="btn-check" name="reservationTime" id="05" value="05">
                                <label class="btn btn-success opacity-100 me-2 d-flex justify-content-center align-items-center time-label" for="05"  style="width: 10em; height: 5em;" id="lab05">05:00</label>
                                <input type="radio" class="btn-check" name="reservationTime" id="06" value="06">
                                <label class="btn btn-success opacity-100 me-2 d-flex justify-content-center align-items-center time-label" for="06"  style="width: 10em; height: 5em;" id="lab06">06:00</label>
                                <input type="radio" class="btn-check" name="reservationTime" id="07" value="07">
                                <label class="btn btn-success opacity-100 me-2 d-flex justify-content-center align-items-center time-label" for="07"  style="width: 10em; height: 5em;" id="lab07">07:00</label>
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="d-flex">
                                <input type="radio" class="btn-check" name="reservationTime" id="08" value="08">
                                <label class="btn btn-success opacity-100 me-2 d-flex justify-content-center align-items-center time-label" for="08"  style="width: 10em; height: 5em;" id="lab08">08:00</label>
                                <input type="radio" class="btn-check" name="reservationTime" id="09" value="09">
                                <label class="btn btn-success opacity-100 me-2 d-flex justify-content-center align-items-center time-label" for="09"  style="width: 10em; height: 5em;" id="lab09">09:00</label>
                                <button class="btn btn-success opacity-100 me-2" type="button" style="width: 10em; height: 5em; visibility: hidden;"></button>
                                <button class="btn btn-success opacity-100 me-2" type="button" style="width: 10em; height: 5em; visibility: hidden;"></button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="d-flex justify-content-center">
                        <input type="hidden" id="customerIdx" name="customerIdx" value="2">   <!--  나중에 수정해야함, th:value  -->
                        <input type="hidden" id="ceoIdx" name="ceoIdx" value="2">
                        <input type="hidden" id="customerName" name="customerName" value="테스터2">
                        <button class="btn btn-secondary mx-5" type="button" style="width: 6em; height: 3em;" id="cancel">거절</button>
                        <button class="btn btn-primary mx-5" type="submit" style="width: 6em; height: 3em;" id="submit">승인</button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</main>

<footer th:replace="~{layout/footer :: footer}"></footer>
</body>
</html>